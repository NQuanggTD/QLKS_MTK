@{
    Layout = "_Layout";
    ViewData["Title"] = "Thanh toán";
}

<div class="page-header">
    <h1><i class="fas fa-credit-card"></i> Thanh toán</h1>
</div>

<!-- Filter Bar -->
<div class="filter-bar">
    <div class="filter-group">
        <label>Trạng thái thanh toán:</label>
        <select id="paymentStatusFilter" onchange="filterPayments()">
            <option value="">Tất cả</option>
            <option value="0" selected>Chưa thanh toán</option>
            <option value="1">Đã thanh toán một phần</option>
            <option value="2">Đã thanh toán đầy đủ</option>
        </select>
    </div>
    <div class="filter-group">
        <label>Tìm kiếm:</label>
        <input type="text" id="searchInput" placeholder="Tên khách, số phòng..." onkeyup="filterPayments()">
    </div>
</div>

<!-- Bookings Table -->
<div class="dashboard-card">
    <div class="card-header">
        <h3>Danh sách booking cần thanh toán</h3>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Mã booking</th>
                        <th>Khách hàng</th>
                        <th>Phòng</th>
                        <th>Ngày trả</th>
                        <th>Tổng tiền</th>
                        <th>Đã cọc</th>
                        <th>Còn lại</th>
                        <th>TT thanh toán</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody id="paymentsTable">
                    <tr>
                        <td colspan="9" class="text-center">Đang tải...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Payment Detail Modal -->
<div id="paymentModal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h2>Chi tiết thanh toán</h2>
            <button class="modal-close" onclick="closePaymentModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="info-group">
                <div class="info-item">
                    <span class="label">Mã Booking:</span>
                    <span id="modalBookingId"></span>
                </div>
                <div class="info-item">
                    <span class="label">Khách hàng:</span>
                    <span id="modalCustomerName"></span>
                </div>
                <div class="info-item">
                    <span class="label">Phòng:</span>
                    <span id="modalRoomNumber"></span>
                </div>
                <div class="info-item">
                    <span class="label">Ngày nhận:</span>
                    <span id="modalCheckInDate"></span>
                </div>
                <div class="info-item">
                    <span class="label">Ngày trả:</span>
                    <span id="modalCheckOutDate"></span>
                </div>
                <div class="info-item">
                    <span class="label">Số đêm:</span>
                    <span id="modalNumberOfNights"></span>
                </div>
            </div>

            <h4 style="margin-top: 20px;">Chi tiết chi phí</h4>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Khoản thu</th>
                        <th>Số lượng</th>
                        <th>Đơn giá</th>
                        <th>Thành tiền</th>
                    </tr>
                </thead>
                <tbody id="modalChargesTable">
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="3" style="text-align: right; font-weight: bold;">Tổng cộng:</td>
                        <td style="font-weight: bold; color: #e74c3c;" id="modalTotalAmount"></td>
                    </tr>
                    <tr>
                        <td colspan="3" style="text-align: right;">Đã đặt cọc:</td>
                        <td id="modalDepositAmount"></td>
                    </tr>
                    <tr>
                        <td colspan="3" style="text-align: right; font-weight: bold;">Còn phải trả:</td>
                        <td style="font-weight: bold; color: #27ae60;" id="modalRemainingAmount"></td>
                    </tr>
                </tfoot>
            </table>

            <div class="form-group" style="margin-top: 20px;">
                <label>Phương thức thanh toán <span class="required">*</span></label>
                <select id="modalPaymentMethod" class="form-control">
                    <option value="0">Tiền mặt</option>
                    <option value="1">Thẻ tín dụng</option>
                    <option value="2">Chuyển khoản</option>
                </select>
            </div>

            <div class="form-actions">
                <button class="btn btn-secondary" onclick="closePaymentModal()">Hủy</button>
                <button class="btn btn-success" onclick="confirmPayment()" id="confirmPayBtn">
                    <i class="fas fa-check"></i> Xác nhận đã thanh toán
                </button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/payment.js"></script>
}
